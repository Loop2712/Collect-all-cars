<!--============= 3 card -- 4-4-4  ================-->
<div class="row mb-4">
    <!--MAP ปักหมุดการขอความช่วยเหลือในจังหวัด -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0 font-weight-bold">MAP ปักหมุดการขอความช่วยเหลือในจังหวัด</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>

                <div class="mt-4 mb-4">
                   <div id="sos_map_organization"></div>
                </div>
            </div>
        </div>
    </div>

     <!--พื้นที่การขอความช่วยเหลือมากที่สุด 5 อันดับ -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="d-flex align-items-center m-3">
                <div>
                    <h5 class="mb-1 font-weight-bold">พื้นที่การขอความช่วยเหลือมากที่สุด 5 อันดับ</h5>
                </div>
                <div class="dropdown ms-auto">
                    <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                        data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                    </div>
                    <div class="dropdown-menu dropdown-menu-right">
                        <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="w-100">
                    <div id="Top5_Area_SOS"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- หัวข้อการขอความช่วยเหลือมากที่สุด sos_1669_form_yellows->symptom -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold">หัวข้อการขอความช่วยเหลือมากที่สุด</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <div id="sos_1669_form_yellows"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- รับแจ้งเตือนทาง -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <h5 class="mb-0 font-weight-bold">รับแจ้งเตือนทาง</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>

                <div class="table-responsive mt-4 mb-4">
                    <table class="table align-middle mb-0">
                        <tbody>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-primary'></i>
                                        </div>
                                        <div>แพลตฟอร์มวีเช็ค</div>
                                    </div>
                                </td>
                                <td>562 ครั้ง</td>
                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-danger'></i>
                                        </div>
                                        <div>โทรศัพท์หมายเลข ๑๖๖๙</div>
                                    </div>
                                </td>
                                <td>561 ครั้ง</td>

                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-success'></i>
                                        </div>
                                        <div>โทรศัพท์หมายเลข ๑๖๖๙ (second call)</div>
                                    </div>
                                </td>
                                <td>452 ครั้ง</td>

                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-warning'></i>
                                        </div>
                                        <div>โทรศัพท์หมายเลขอื่นๆ</div>
                                    </div>
                                </td>
                                <td>444 ครั้ง</td>
                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-info'></i>
                                        </div>
                                        <div>วิทยุสื่อสาร</div>
                                    </div>
                                </td>
                                <td>235 ครั้ง</td>
                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-dark'></i>
                                        </div>
                                        <div>วิธีอื่นๆ  </div>
                                    </div>
                                </td>
                                <td>235 ครั้ง</td>
                            </tr>
                            <tr>
                                <td class="px-0">
                                    <div class="d-flex align-items-center">
                                        <div><i class='bx bxs-checkbox me-2 font-24 text-primary'></i>
                                        </div>
                                        <div>ส่งต่อชุดปฏิบัติการระดับสูงกว่า</div>
                                    </div>
                                </td>
                                <td>145 ครั้ง</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ระดับสถานการณ์ประเมินโดย ศูนย์สั่งการ -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold">ระดับสถานการณ์ประเมินโดย ศูนย์สั่งการ</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <div id="sos_1669_form_yellows_idc"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ระดับสถานการณ์ประเมินโดย หน่วยปฏิบัติการ -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold"> ระดับสถานการณ์ประเมินโดย หน่วยปฏิบัติการ</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <div id="sos_1669_form_yellows_rc"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- การปฏิบัติการ -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold"> การปฏิบัติการ</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <div id="operation"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- การปฏิบัติการ มีการรักษา -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold">การปฏิบัติการที่มีการรักษา</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="h-100">
                    <div id="operation_cure"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- การปฏิบัติการ ไม่มีการรักษา -->
    <div class="col-12 col-lg-4 mb-3">
        <div class="card radius-10 h-100">
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <h5 class="mb-0 font-weight-bold">การปฏิบัติการที่ไม่มีการรักษา</h5>
                    <div class="dropdown ms-auto">
                        <div class="cursor-pointer text-dark font-24 dropdown-toggle dropdown-toggle-nocaret"
                            data-bs-toggle="dropdown"><i class="bx bx-dots-horizontal-rounded"></i>
                        </div>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item" href="javaScript:;">ดูข้อมูลสมาชิกเพิ่มเติม</a>
                        </div>
                    </div>
                </div>
                <div class="h-100">
                    <div id="operation_no_cure"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- apexcharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<!-- map-googleAPI -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgrxXDgk1tgXngalZF3eWtcTWI-LPdeus&language=th"></script>

<style type="text/css">
    #sos_map_organization {
      height: calc(40vh);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        initMap();
    });
</script>
<!-- MAP พื้นที่การขอความช่วยเหลือในจังหวัด -->
<script>
    function initMap() {
        console.log("MAPPPPPP");
        // 13.7248936,100.4930264 lat lng ประเทศไทย
        let map = new google.maps.Map(document.getElementById("sos_map_organization"), {
            center: {lat: 13.7248936, lng: 100.4930264 },
            zoom: 5,
        });

        // let all_lat = [];
        // let all_lng = [];
        // let all_lat_lng = [];

        // let lat_average ;
        // let lng_average ;

        // let lat_sum = 0 ;
        // let lng_sum = 0 ;

        // let name_partner = document.querySelector('#name_partner');

        // fetch("{{ url('/') }}/api/sos_data_map/")
        //     .then(response => response.json())
        //     .then(result => {
        //         // console.log(result);

        //         for (let ii = 0; ii < result.length; ii++) {

        //             all_lat.push(JSON.parse(result[ii]['sos_area'])[xx]['lat']);
        //             all_lng.push(JSON.parse(result[ii]['sos_area'])[xx]['lng']);
        //         }

        //         let bounds = new google.maps.LatLngBounds();

        //             for (let vc = 0; vc < all_lat_lng.length; vc++) {
        //                 bounds.extend(all_lat_lng[vc]);
        //             }

        //             map = new google.maps.Map(document.getElementById("map"), {
        //                 // zoom: num_zoom,
        //                 // center: bounds.getCenter(),
        //             });
        //             map.fitBounds(bounds);

        //         for (let xi = 0; xi < result.length; xi++) {

        //             // วาดพื้นที่รวมทั้งหมด
        //             let draw_sum_area = new google.maps.Polygon({
        //                 paths: all_lat_lng,
        //                 strokeColor: "red",
        //                 strokeOpacity: 0,
        //                 strokeWeight: 0,
        //                 fillColor: "red",
        //                 fillOpacity: 0,
        //             });
        //             draw_sum_area.setMap(map);

        //             // วาดแยกแต่ละพื้นที่
        //             let draw_area_other = new google.maps.Polygon({
        //                 paths: JSON.parse(result[xi]['sos_area']),
        //                 strokeColor: "#008450",
        //                 strokeOpacity: 0.8,
        //                 strokeWeight: 1,
        //                 fillColor: "#008450",
        //                 fillOpacity: 0.25,
        //                 zIndex:10,
        //             });
        //             draw_area_other.setMap(map);

        //             // mouseover on polygon
        //             google.maps.event.addListener(draw_area_other, 'mouseover', function (event) {
        //                 this.setOptions({
        //                     strokeColor: '#00ff00',
        //                     fillColor: '#00ff00'
        //                 });

        //                 let image_empty = "https://www.viicheck.com/img/icon/flag_empty.png";

        //                 for (let mm = 0; mm < JSON.parse(result[xi]['sos_area']).length; mm++) {

        //                     all_lat.push(JSON.parse(result[xi]['sos_area'])[mm]['lat']);
        //                     all_lng.push(JSON.parse(result[xi]['sos_area'])[mm]['lng']);

        //                 }

        //                 for (let zz = 0; zz < all_lat.length; zz++) {

        //                     lat_sum = lat_sum + all_lat[zz] ;
        //                     lng_sum = lng_sum + all_lng[zz] ;

        //                     lat_average = lat_sum / all_lat.length ;
        //                     lng_average = lng_sum / all_lng.length ;
        //                 }

        //                 marker_mouseover = new google.maps.Marker({
        //                     // position: JSON.parse(result[xi]['sos_area'])[0],
        //                     position: {lat: lat_average, lng: lng_average },
        //                     map: map,
        //                     icon: image_empty,
        //                     label: {
        //                         text: result[xi]['name_area'],
        //                         color: 'black',
        //                         fontSize: "18px",
        //                         fontWeight: 'bold',
        //                     },
        //                     zIndex:10,
        //                 });

        //             });

        //             // mouseout polygon
        //             google.maps.event.addListener(draw_area_other, 'mouseout', function (event) {
        //                 this.setOptions({
        //                     strokeColor: '#008450',
        //                     fillColor: '#008450'
        //                 });
        //                 marker_mouseover.setMap(null);

        //                 lat_sum = 0 ;
        //                 lng_sum = 0 ;
        //                 lat_average = 0 ;
        //                 lng_average = 0 ;
        //                 all_lat = [] ;
        //                 all_lng = [] ;
        //             });

        //             draw_area_other.addListener("click", () => {
        //                 // select_name_area(result[xi]['name_area']);
        //                 try {
        //                     document.querySelector('#select_name_area_' + result[xi]['name_area']).click();
        //                 }
        //                 catch(err) {
        //                     alert('ไม่มีข้อมูลการขอความช่วยเหลือ');
        //                 }

        //             });
        //         }


        //     });

    }
</script>

<!-- Column CHART พื้นที่การขอความช่วยเหลือมากที่สุด 5 อันดับ -->
<script>
    let series_arr = [];
    let categories_arr = [];
    let count_address = 0;

    @foreach ($sos_area_top5 as $item)
        @php
            // ใช้ฟังก์ชัน explode เพื่อแยกข้อมูลใน $item->address ด้วยเครื่องหมาย /
            $addressParts = explode('/', $item->address);
            // นำข้อมูล index ที่ 1 มาเก็บใน series_arr (เนื่องจาก index เริ่มต้นที่ 0)
            $addressPartIndex1 = $addressParts[1];
        @endphp

        console.log('{{$addressPartIndex1}}');



        categories_arr.push(addressPartIndex1);
        series_arr.push(count_address);
    @endforeach

    var options = {
         series: [{
         data: categories_arr
       }],
         chart: {
         type: 'bar',
         height: 380,
         width: '100%'
       },
       plotOptions: {
         bar: {
           barHeight: '100%',
           distributed: true,
           horizontal: true,
           dataLabels: {
             position: 'bottom'
           },
         }
       },
       colors: ['#33b2df',  '#d4526e',  '#f48024',  '#f9a3a4', '#90ee7e',],
       dataLabels: {
         enabled: true,
         textAnchor: 'start',
         style: {
           colors: ['#000']
         },
         formatter: function (val, opt) {
           return opt.w.globals.labels[opt.dataPointIndex] + ":  " + val
         },
         offsetX: 0,
         dropShadow: {
           enabled: true
         }
       },
       stroke: {
         width: 1,
         colors: ['#fff']
       },
       xaxis: {
         categories: series_arr,
       },
       yaxis: {
         labels: {
           show: false
         }
       },
    //    title: {
    //        text: 'Custom DataLabels',
    //        align: 'center',
    //        floating: true
    //    },
    //    subtitle: {
    //        text: 'Category Names as DataLabels inside bars',
    //        align: 'center',
    //    },
       tooltip: {
         theme: 'dark',
         x: {
           show: false
         },
         y: {
           title: {
             formatter: function () {
               return ''
             }
           }
         }
       }
       };

       var chart = new ApexCharts(document.querySelector("#Top5_Area_SOS"), options);
       chart.render();

</script>

<!-- DONUT CHART หัวข้อการขอความช่วยเหลือมากที่สุด -->
<script>

    var options = {
        series: [44, 55, 41, 17, 15],
        chart: {
        width: 450,
        type: 'donut',
    },
    legend: {
        position: 'bottom',
    },
    responsive: [{
        breakpoint: 480,
            options: {
                chart: {
                width: 400
                },
                legend: {
                position: 'bottom'
                }
            }
        }]
    };

    var chart = new ApexCharts(document.querySelector("#sos_1669_form_yellows"), options);
    chart.render();

</script>

<!-- PIE CHART ระดับสถานการณ์ประเมินโดย ศูนย์สั่งการ -->
<script>

    var options = {
        series: [44, 55, 41, 17, 15],
        chart: {
        width: 470,
        type: 'pie',
    },
    legend: {
        position: 'bottom',
    },
    responsive: [{
        breakpoint: 480,
            options: {
                chart: {
                width: 400
                },
                legend: {
                position: 'bottom'
                }
            }
        }]
    };

    var chart = new ApexCharts(document.querySelector("#sos_1669_form_yellows_idc"), options);
    chart.render();

</script>

<!-- PIE CHART ระดับสถานการณ์ประเมินโดย หน่วยปฏิบัติการ -->
<script>

    var options = {
        series: [44, 55, 41, 17, 15],
        chart: {
        width: 470,
        type: 'pie',
    },
    legend: {
        position: 'bottom',
    },
    responsive: [{
        breakpoint: 480,
            options: {
                chart: {
                width: 400
                },
                legend: {
                position: 'bottom'
                }
            }
        }]
    };

    var chart = new ApexCharts(document.querySelector("#sos_1669_form_yellows_rc"), options);
    chart.render();

</script>

<!-- DONUT CHART การปฏิบัติการ -->
<script>
    var options = {
        series: [222, 55],
        chart: {
        width: 450,
        type: 'donut',
    },
    labels: ["มีการรักษา" , "ไม่มีการรักษา" ],
    colors: ['#2dce89', '#f5365c'], // กำหนดสีที่ต้องการ
    legend: {
        position: 'bottom',
    },
    responsive: [{
        breakpoint: 480,
            options: {
                chart: {
                width: 400
                },
                legend: {
                position: 'bottom'
                }
            }
        }]
    };

    var chart = new ApexCharts(document.querySelector("#operation"), options);
    chart.render();

</script>

<!-- Column CHART การปฏิบัติการ CURE -->
<script>
    var options = {
         series: [{
         data: [ 1380 , 1100 , 840 , 430 , 400 ]
       }],
         chart: {
         type: 'bar',
         height: 380,
         width: '100%'
       },
       plotOptions: {
         bar: {
           barHeight: '100%',
           distributed: true,
           horizontal: true,
           dataLabels: {
             position: 'bottom'
           },
         }
       },
       colors: ['#28a745',  '#33b2df',  '#ffc107',  '#f48024', '#d4526e',],
       dataLabels: {
         enabled: true,
         textAnchor: 'start',
         style: {
           colors: ['#000']
         },
         formatter: function (val, opt) {
           return opt.w.globals.labels[opt.dataPointIndex] + ":  " + val
         },
         offsetX: 0,
         dropShadow: {
           enabled: true
         }
       },
       stroke: {
         width: 1,
         colors: ['#fff']
       },
       xaxis: {
         categories: ['นำส่งโรงพยาบาล', 'ส่งต่อชุดปฏิบัติการระดับสูงกว่า', 'ไม่นำส่ง', 'เสียชีวิตระหว่างนำส่ง', 'เสียชีวิต ณ จุดเกิดเหตุ',],

       },
       yaxis: {
         labels: {
           show: false
         }
       },
    //    title: {
    //        text: 'Custom DataLabels',
    //        align: 'center',
    //        floating: true
    //    },
    //    subtitle: {
    //        text: 'Category Names as DataLabels inside bars',
    //        align: 'center',
    //    },
       tooltip: {
         theme: 'dark',
         x: {
           show: false
         },
         y: {
           title: {
             formatter: function () {
               return ''
             }
           }
         }
       }
       };

       var chart = new ApexCharts(document.querySelector("#operation_cure"), options);
       chart.render();

</script>

<!-- Column CHART การปฏิบัติการ NO CURE -->
<script>
    var options = {
         series: [{
         data: [ 555 , 450 , 254 , 59]
       }],
         chart: {
         type: 'bar',
         height: 380,
         width: '100%'
       },
       plotOptions: {
         bar: {
           barHeight: '100%',
           distributed: true,
           horizontal: true,
           dataLabels: {
             position: 'bottom'
           },
         }
       },
       colors: ['#28a745', '#ffc107', '#f48024', '#d4526e',],
       dataLabels: {
         enabled: true,
         textAnchor: 'start',
         style: {
           colors: ['#000']
         },
         formatter: function (val, opt) {
           return opt.w.globals.labels[opt.dataPointIndex] + ":  " + val
         },
         offsetX: 0,
         dropShadow: {
           enabled: true
         }
       },
       stroke: {
         width: 1,
         colors: ['#fff']
       },
       xaxis: {
         categories: ['ผู้ป่วยปฏิเสธการรักษา', 'ยกเลิก', 'ไม่พบเหตุ', 'เสียชีวิตก่อนชุดปฏิบัติการไปถึง'],

       },
       yaxis: {
         labels: {
           show: false
         }
       },
    //    title: {
    //        text: 'Custom DataLabels',
    //        align: 'center',
    //        floating: true
    //    },
    //    subtitle: {
    //        text: 'Category Names as DataLabels inside bars',
    //        align: 'center',
    //    },
       tooltip: {
         theme: 'dark',
         x: {
           show: false
         },
         y: {
           title: {
             formatter: function () {
               return ''
             }
           }
         }
       }
       };

       var chart = new ApexCharts(document.querySelector("#operation_no_cure"), options);
       chart.render();

</script>






